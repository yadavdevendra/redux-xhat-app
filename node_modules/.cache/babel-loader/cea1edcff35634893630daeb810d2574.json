{"ast":null,"code":"/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nimport { sleep, randomToken, microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nexport var type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexport function getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n  return localStorage;\n}\nexport function storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    sleep().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: randomToken(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nexport function addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n  window.addEventListener('storage', listener);\n  return listener;\n}\nexport function removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n  var uuid = randomToken();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n  };\n\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nexport function close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n  return true;\n}\nexport function averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n  return defaultTime;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};","map":{"version":3,"names":["ObliviousSet","fillOptionsWithDefaults","sleep","randomToken","microSeconds","micro","isNode","KEY_PREFIX","type","getLocalStorage","localStorage","window","e","storageKey","channelName","postMessage","channelState","messageJson","Promise","res","then","key","writeObj","token","time","Date","getTime","data","uuid","value","JSON","stringify","setItem","ev","document","createEvent","initEvent","newValue","dispatchEvent","addStorageEventListener","fn","listener","parse","addEventListener","removeStorageEventListener","removeEventListener","create","options","canBeUsed","Error","eMIs","localstorage","removeTimeout","state","msgObj","messagesCallback","has","messagesCallbackTime","add","close","onMessage","ls","removeItem","averageResponseTime","defaultTime","userAgent","navigator","toLowerCase","includes"],"sources":["/home/cedcoss/Desktop/redux-xhat-app/node_modules/broadcast-channel/dist/es/methods/localstorage.js"],"sourcesContent":["/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nimport { sleep, randomToken, microSeconds as micro, isNode } from '../util';\nexport var microSeconds = micro;\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nexport var type = 'localstorage';\n/**\n * copied from crosstab\n * @link https://github.com/tejacques/crosstab/blob/master/src/crosstab.js#L32\n */\n\nexport function getLocalStorage() {\n  var localStorage;\n  if (typeof window === 'undefined') return null;\n\n  try {\n    localStorage = window.localStorage;\n    localStorage = window['ie8-eventlistener/storage'] || window.localStorage;\n  } catch (e) {// New versions of Firefox throw a Security exception\n    // if cookies are disabled. See\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1028153\n  }\n\n  return localStorage;\n}\nexport function storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n* writes the new message to the storage\n* and fires the storage-event so other readers can find it\n*/\n\nexport function postMessage(channelState, messageJson) {\n  return new Promise(function (res) {\n    sleep().then(function () {\n      var key = storageKey(channelState.channelName);\n      var writeObj = {\n        token: randomToken(),\n        time: new Date().getTime(),\n        data: messageJson,\n        uuid: channelState.uuid\n      };\n      var value = JSON.stringify(writeObj);\n      getLocalStorage().setItem(key, value);\n      /**\n       * StorageEvent does not fire the 'storage' event\n       * in the window that changes the state of the local storage.\n       * So we fire it manually\n       */\n\n      var ev = document.createEvent('Event');\n      ev.initEvent('storage', true, true);\n      ev.key = key;\n      ev.newValue = value;\n      window.dispatchEvent(ev);\n      res();\n    });\n  });\n}\nexport function addStorageEventListener(channelName, fn) {\n  var key = storageKey(channelName);\n\n  var listener = function listener(ev) {\n    if (ev.key === key) {\n      fn(JSON.parse(ev.newValue));\n    }\n  };\n\n  window.addEventListener('storage', listener);\n  return listener;\n}\nexport function removeStorageEventListener(listener) {\n  window.removeEventListener('storage', listener);\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n\n  if (!canBeUsed()) {\n    throw new Error('BroadcastChannel: localstorage cannot be used');\n  }\n\n  var uuid = randomToken();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new ObliviousSet(options.localstorage.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs // emittedMessagesIds\n\n  };\n  state.listener = addStorageEventListener(channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === uuid) return; // own message\n\n    if (!msgObj.token || eMIs.has(msgObj.token)) return; // already emitted\n\n    if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\nexport function close(channelState) {\n  removeStorageEventListener(channelState.listener);\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var ls = getLocalStorage();\n  if (!ls) return false;\n\n  try {\n    var key = '__broadcastchannel_check';\n    ls.setItem(key, 'works');\n    ls.removeItem(key);\n  } catch (e) {\n    // Safari 10 in private mode will not allow write access to local\n    // storage and fail with a QuotaExceededError. See\n    // https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API#Private_Browsing_Incognito_modes\n    return false;\n  }\n\n  return true;\n}\nexport function averageResponseTime() {\n  var defaultTime = 120;\n  var userAgent = navigator.userAgent.toLowerCase();\n\n  if (userAgent.includes('safari') && !userAgent.includes('chrome')) {\n    // safari is much slower so this time is higher\n    return defaultTime * 2;\n  }\n\n  return defaultTime;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}